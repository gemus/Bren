<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Crossfit DPL</title>
	<link rel="stylesheet" type="text/css" href="/site_media/css/reset-min.css">
	<link rel="stylesheet" type="text/css" href="/site_media/css/global.css">
	<link rel="stylesheet" type="text/css" href="/site_media/css/numpad_input.css" />
	<link rel="stylesheet" type="text/css" href="/site_media/css/user_picker.css" />

	<script type="text/javascript" src="/site_media/js/jquery-1.3.2.min.js"></script>
	<script type="text/javascript" src="/site_media/js/jquery-ui-1.7.2.custom.min.js"></script>
	<script type="text/javascript" src="/site_media/js/numpad_input.js"></script>
	<script type="text/javascript" src="/site_media/js/user_picker.js"></script>

	<style type="text/css" media="screen">
		h1 {
			text-align: center;
			padding: 60px 0pt 30px;
			font-size: 200%;
			background-color: #3C5F7F;
			color: #FFF;
		}

		h2 {
			font-size: 150%;
			font-weight: bold;
			color: #3C5F7F;
			margin-bottom: 3px;
		}

		h3 {
			font-weight: bold;
			color: #3C5F7F;
			font-size: 110%;
		}

		div#pageContainer {
			padding-top: 10pt;
			width: 800px;
			margin: 0pt auto;
		}

		div#userPickerCanvas {
			margin: 0pt auto;
			{% if form.errors %}
			width: 800px;
			{% else %}
			width: 430px;
			{% endif %}
		}

		div#login_content {
			position: absolute;
			left: 575px;
			{% if form.errors %}
			z-index: 10;
			opacity: 1.0;
			{% else %}
			z-index: -1;
			opacity: 0.0;
			{% endif %}
		}

		button.big_button {
			border: 2px solid #3C5F7F;
			background-color: #FFF;
			color: #3C5F7F;
			padding-top: 10px; padding-bottom: 10px;
			cursor: pointer;
			font-size: 200%;
			width: 305px;
		}

		p#errorBox {
			color: #F00;
			margin-top: 15px;
			font-size: 150%;
		}

		input#id_password {
			border: 1px solid #3C5F7F;
			text-align: center;
			font-size: 30px;
			width: 302px;
		}

		div.numpad_input_container {
			margin: 5px 1px;
		}
	</style>

	<script type="text/javascript" charset="utf-8">
		var listItemClickFunction = function(data) {
			$("#id_username").val(data['id']);
		    $("#id_password").val("");
		    $("#name_plate").html(data['display_name']);
		}

		$(document).ready(function() {
			var default_picked = $("#id_username").val();
			$("#id_password").numPadInput(false, "", true, false);

			$("#userPickerCanvas").userPicker();
		});

		var check_user_callback = function(result, status) {
			var result = result.result;
			if (result) {
				$("form").submit()
			} else {
				console.log("Failure");
			}
		}

		var checklogin = function() {
			var username = $("#id_username").val()
			var password = $("#id_password").val()
			$.getJSON("/json_api/", {"id": 1,
                                     "method": "check_user_login",
                                     "params" : '["'+username+'","'+password+'"]'
                                     },
                                     check_user_callback)

			// Never submit the form, callback will do it
			return false;
		}
	</script>

</head>
<body>
	<h1> Welcome To CrossFit DPL</h1>
	<div id="pageContainer">
		<div id="userPickerCanvas"></div>
		<div id="login_content">
			<form method="post" onsubmit="return checklogin();" action="{% url django.contrib.auth.views.login %}">
				<div style="display:none">
					{{ form.username.label_tag }} <br />
					{{ form.username }}
				</div>
				<h2 id="name_plate">&nbsp;</h2>
				{{ form.password }}

				<button type="submit" class="big_button">Login</button>
				<input type="hidden" name="next" value="{{ next }}" />
			</form>
			{% if form.errors %}<p id="errorBox">Wrong PIN. Please try again.</p>{% endif %}
		</div>
	</div>
</body>
</html>